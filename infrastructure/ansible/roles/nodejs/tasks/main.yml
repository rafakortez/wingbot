---
# Role: nodejs — instala Node.js via NodeSource oficial

- name: Verificar se Node.js já está instalado
  command: node --version
  register: node_check
  ignore_errors: true
  changed_when: false

- name: Baixar script de setup do NodeSource
  get_url:
    url: "https://deb.nodesource.com/setup_{{ nodejs_version }}.x"
    dest: /tmp/nodesource_setup.sh
    mode: "0755"
  when: node_check.failed

- name: Executar script de setup do NodeSource
  command: bash /tmp/nodesource_setup.sh
  when: node_check.failed

- name: Instalar Node.js {{ nodejs_version }}.x
  apt:
    name: nodejs
    state: present
    update_cache: yes
  when: node_check.failed

- name: Verificar versão instalada
  command: node --version
  register: node_version
  changed_when: false

- name: Mostrar versão do Node.js
  debug:
    msg: "Node.js instalado: {{ node_version.stdout }}"
